version: 2
updates:
  # ===========================================
  # å‰ç«¯ä¾èµ–æ›´æ–° - æåº¦ä¿å®ˆç­–ç•¥
  # ===========================================
  - package-ecosystem: "npm"
    directory: "/web"
    schedule:
      interval: "monthly" # æ”¹ä¸ºæœˆåº¦æ£€æŸ¥ï¼Œé™ä½é¢‘ç‡
      day: "monday"
      time: "08:00"
      timezone: "Asia/Shanghai"
    open-pull-requests-limit: 2 # å¤§å¹…é™ä½ PR æ•°é‡é™åˆ¶
    labels:
      - "dependencies"
      - "frontend"
      - "needs-manual-testing" # æ·»åŠ æ‰‹åŠ¨æµ‹è¯•æ ‡ç­¾
      - "stability-critical" # æ ‡è®°ä¸ºç¨³å®šæ€§å…³é”®
    commit-message:
      prefix: "chore"
      include: "scope"
    versioning-strategy: "increase-if-necessary"

    # åˆ†ç»„ç­–ç•¥ - åªå…è®¸ç‰¹å®šç±»å‹çš„æ›´æ–°
    groups:
      # å®‰å…¨æ›´æ–° - å”¯ä¸€å…è®¸çš„è‡ªåŠ¨æ›´æ–°
      critical-security:
        applies-to: security-updates
        patterns: ["*"]
        update-types: ["patch"] # å³ä½¿å®‰å…¨æ›´æ–°ä¹Ÿåªå…è®¸è¡¥ä¸ç‰ˆæœ¬

      # å¼€å‘å·¥å…· - ç›¸å¯¹å®‰å…¨çš„æ›´æ–°
      dev-tools-safe:
        dependency-type: "development"
        patterns:
          - "eslint"
          - "prettier"
          - "@eslint/*"
          - "eslint-*"
        update-types: ["patch"]

    # å¤§èŒƒå›´å¿½ç•¥ç­–ç•¥
    ignore:
      # ===== å®Œå…¨ç¦æ­¢è‡ªåŠ¨æ›´æ–°çš„å…³é”®åŒ… =====

      # React æ ¸å¿ƒç”Ÿæ€ - æ‰‹åŠ¨æ§åˆ¶
      - dependency-name: "react"
        update-types:
          [
            "version-update:semver-major",
            "version-update:semver-minor",
            "version-update:semver-patch",
          ]
      - dependency-name: "react-dom"
        update-types:
          [
            "version-update:semver-major",
            "version-update:semver-minor",
            "version-update:semver-patch",
          ]
      - dependency-name: "@types/react"
        update-types:
          [
            "version-update:semver-major",
            "version-update:semver-minor",
            "version-update:semver-patch",
          ]
      - dependency-name: "@types/react-dom"
        update-types:
          [
            "version-update:semver-major",
            "version-update:semver-minor",
            "version-update:semver-patch",
          ]
      - dependency-name: "react-router"
        update-types:
          [
            "version-update:semver-major",
            "version-update:semver-minor",
            "version-update:semver-patch",
          ]

      # è¡¨å•å’ŒéªŒè¯åº“ - ç±»å‹ç³»ç»Ÿå¤æ‚
      - dependency-name: "react-hook-form"
        update-types:
          [
            "version-update:semver-major",
            "version-update:semver-minor",
            "version-update:semver-patch",
          ]
      - dependency-name: "@hookform/resolvers"
        update-types:
          [
            "version-update:semver-major",
            "version-update:semver-minor",
            "version-update:semver-patch",
          ]
      - dependency-name: "zod"
        update-types:
          [
            "version-update:semver-major",
            "version-update:semver-minor",
            "version-update:semver-patch",
          ]

      # TypeScript ç›¸å…³ - å½±å“æ•´ä¸ªç¼–è¯‘é“¾
      - dependency-name: "typescript"
        update-types:
          [
            "version-update:semver-major",
            "version-update:semver-minor",
            "version-update:semver-patch",
          ]
      - dependency-name: "@types/*"
        update-types:
          ["version-update:semver-major", "version-update:semver-minor"]

      # æ„å»ºå·¥å…· - å½±å“æ„å»ºæµç¨‹
      - dependency-name: "vite"
        update-types:
          ["version-update:semver-major", "version-update:semver-minor"]
      - dependency-name: "@vitejs/*"
        update-types:
          ["version-update:semver-major", "version-update:semver-minor"]
      - dependency-name: "esbuild"
        update-types:
          ["version-update:semver-major", "version-update:semver-minor"]

      # UI æ¡†æ¶ - å¯èƒ½å½±å“æ ·å¼å’Œäº¤äº’
      - dependency-name: "@radix-ui/*"
        update-types:
          ["version-update:semver-major", "version-update:semver-minor"]
      - dependency-name: "tailwindcss"
        update-types: ["version-update:semver-major"]
      - dependency-name: "lucide-react"
        update-types: ["version-update:semver-major"]

      # çŠ¶æ€ç®¡ç†å’Œæ•°æ®è·å–
      - dependency-name: "*query*" # React Query ç­‰
        update-types:
          ["version-update:semver-major", "version-update:semver-minor"]
      - dependency-name: "axios"
        update-types: ["version-update:semver-major"]
      - dependency-name: "immer"
        update-types: ["version-update:semver-major"]

      # 3D å’Œå¤æ‚ç»„ä»¶åº“
      - dependency-name: "three"
        update-types:
          ["version-update:semver-major", "version-update:semver-minor"]
      - dependency-name: "three-globe"
        update-types:
          ["version-update:semver-major", "version-update:semver-minor"]

      # ===== ç¦æ­¢æ‰€æœ‰ä¸»ç‰ˆæœ¬å’Œå°ç‰ˆæœ¬æ›´æ–° =====
      - dependency-name: "*"
        update-types:
          ["version-update:semver-major", "version-update:semver-minor"]

  # ===========================================
  # Go ä¾èµ–æ›´æ–° - ä¿æŒé€‚åº¦æ›´æ–°ç­–ç•¥
  # ===========================================
  - package-ecosystem: "gomod"
    directories:
      - "/server"
      - "/pkg"
      - "/coraza-spoa"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "08:00"
      timezone: "Asia/Shanghai"
    open-pull-requests-limit: 8 # ç•¥å¾®é™ä½é™åˆ¶
    labels:
      - "dependencies"
      - "go"
      - "backend"
    commit-message:
      prefix: "chore"
      include: "scope"

    groups:
      # Go å°ç‰ˆæœ¬å’Œè¡¥ä¸æ›´æ–° - ç›¸å¯¹å®‰å…¨
      go-minor-patch:
        applies-to: version-updates
        patterns: ["*"]
        update-types: ["minor", "patch"]

      # å®‰å…¨æ›´æ–° - é«˜ä¼˜å…ˆçº§
      go-security:
        applies-to: security-updates
        patterns: ["*"]

    ignore:
      # åªå¿½ç•¥ä¸»ç‰ˆæœ¬æ›´æ–°ï¼Œå…è®¸å°ç‰ˆæœ¬å’Œè¡¥ä¸
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]

  # ===========================================
  # GitHub Actions æ›´æ–° - ä¿æŒç°æœ‰ç­–ç•¥
  # ===========================================
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "08:00"
      timezone: "Asia/Shanghai"
    open-pull-requests-limit: 4 # ç•¥å¾®é™ä½
    labels:
      - "dependencies"
      - "github-actions"
      - "ci"
    commit-message:
      prefix: "ci"
      include: "scope"

    groups:
      github-actions-all:
        patterns: ["*"]
        update-types: ["minor", "patch"]

    ignore:
      # åªå¿½ç•¥ä¸»ç‰ˆæœ¬æ›´æ–°
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]

  # ===========================================
  # Docker åŸºç¡€é•œåƒæ›´æ–° - ä¿å®ˆç­–ç•¥
  # ===========================================
  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "08:00"
      timezone: "Asia/Shanghai"
    open-pull-requests-limit: 3 # é™ä½é™åˆ¶
    labels:
      - "dependencies"
      - "docker"
      - "infrastructure"
    commit-message:
      prefix: "docker"
      include: "scope"

    groups:
      docker-minor-patch:
        patterns: ["*"]
        update-types: ["minor", "patch"]

    ignore:
      # å¿½ç•¥ä¸»ç‰ˆæœ¬æ›´æ–°
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]

      # ===== ç‰¹å®šç‰ˆæœ¬é”å®š =====
      # é”å®š HAProxy ç‰ˆæœ¬ - ç¡®ä¿ WAF åŠŸèƒ½ç¨³å®š
      - dependency-name: "haproxy"
        versions: [">3.0.10"]

      # é”å®š Golang æ„å»ºç‰ˆæœ¬ - ç¡®ä¿åç«¯æ„å»ºç¯å¢ƒä¸€è‡´æ€§
      - dependency-name: "golang"
        versions: [">1.24.1"]

      # é”å®šåŸºç¡€é•œåƒçš„ä¸»ç‰ˆæœ¬
      - dependency-name: "node"
        versions: [">22.0.0"] # å¦‚æœå½“å‰ä½¿ç”¨ Node 20.xï¼Œä¸è‡ªåŠ¨å‡çº§åˆ° 22.x
      - dependency-name: "alpine"
        versions: [">3.20.0"] # ä¿æŒ Alpine ç‰ˆæœ¬ç¨³å®š


  # ===========================================
  # Dockerfile å¤šé˜¶æ®µæ„å»ºçš„å…¶ä»–é…ç½®
  # ===========================================

  # å¦‚æœæœ‰å…¶ä»– package managers (å¦‚ pip, maven ç­‰)
  # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç±»ä¼¼çš„ä¿å®ˆé…ç½®

  # ç¤ºä¾‹ï¼šå¦‚æœé¡¹ç›®ä¸­æœ‰ Python ä¾èµ–
  # - package-ecosystem: "pip"
  #   directory: "/scripts"  # å¦‚æœæœ‰ Python è„šæœ¬ç›®å½•
  #   schedule:
  #     interval: "monthly"
  #   open-pull-requests-limit: 2
  #   labels:
  #     - "dependencies"
  #     - "python"
  #     - "scripts"
  #   ignore:
  #     - dependency-name: "*"
  #       update-types: ["version-update:semver-major", "version-update:semver-minor"]
# ===========================================
# å…¨å±€é…ç½®è¯´æ˜
# ===========================================
#
# ğŸ¯ ç­–ç•¥æ€»ç»“ï¼š
#
# å‰ç«¯ (npm): æåº¦ä¿å®ˆ
# - æœˆåº¦æ£€æŸ¥ï¼Œæœ€å¤š 2 ä¸ª PR
# - åªå…è®¸å®‰å…¨è¡¥ä¸è‡ªåŠ¨æ›´æ–°
# - å…³é”®åŒ…å®Œå…¨ç¦æ­¢è‡ªåŠ¨æ›´æ–°
#
# åç«¯ (Go): é€‚åº¦æ›´æ–°
# - å‘¨åº¦æ£€æŸ¥ï¼Œæœ€å¤š 8 ä¸ª PR
# - å…è®¸å°ç‰ˆæœ¬å’Œè¡¥ä¸æ›´æ–°
# - åªç¦æ­¢ä¸»ç‰ˆæœ¬æ›´æ–°
#
# CI/CD: ä¿å®ˆæ›´æ–°
# - GitHub Actions å…è®¸å°ç‰ˆæœ¬æ›´æ–°
# - Docker é•œåƒä¿å®ˆæ›´æ–°ï¼Œé”å®šå…³é”®ç‰ˆæœ¬
#
# ğŸ”§ æ‰‹åŠ¨æ›´æ–°æµç¨‹ï¼š
#
# 1. å‰ç«¯å…³é”®ä¾èµ–éœ€è¦å­£åº¦è¯„ä¼°
# 2. åœ¨ä¸“é—¨çš„åˆ†æ”¯ä¸­æµ‹è¯•æ›´æ–°
# 3. å……åˆ†æµ‹è¯•åå†åˆå¹¶
# 4. ä¿æŒè¯¦ç»†çš„æ›´æ–°æ—¥å¿—
